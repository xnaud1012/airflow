<!DOCTYPE html>
<html lang="en">
<head>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./toast_ui/tui-grid/dist/tui-grid.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/css/style.css') }}">
    <script src="{{ url_for('review_plugin.static', filename='./js/jquery-3.7.1.min.js') }}"></script>   
    <!-- DataTables JS -->
    <script src="{{ url_for('review_plugin.static', filename='./toast_ui/tui-grid/dist/tui-grid.min.js') }}"></script>
    <script src="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/js/main.js') }}"></script>

</head>
<style>


</style>
<body>
    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
          <a href="index.html" class="logo d-flex align-items-center">
            <img src="assets/img/profile-img.jpg" alt="" >
            <span class="d-none d-lg-block">전남대병원</span>
          </a>
          <i class="bi bi-list toggle-sidebar-btn"></i>
        </div><!-- End Logo -->
    
        <div class="search-bar">
          <form class="search-form d-flex align-items-center" method="POST" action="#">
            <input type="text" name="query" placeholder="Search" title="Enter search keyword">
            <button type="submit" title="Search"><i class="bi bi-search"></i></button>
          </form>
        </div><!-- End Search Bar -->
    
        <nav class="header-nav ms-auto">
          <ul class="d-flex align-items-center">
    
            <li class="nav-item d-block d-lg-none">
              <a class="nav-link nav-icon search-bar-toggle " href="#">
                <i class="bi bi-search"></i>
              </a>
            </li><!-- End Search Icon-->
    
            <li class="nav-item dropdown">
    
              <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                <i class="bi bi-bell"></i>
                <span id="rowCount" class="badge bg-primary badge-number">0</span>
              </a><!-- End Notification Icon -->
    
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
                <li class="dropdown-header">
                  You have 4 new notifications
                  <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">View all</span></a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="notification-item">
                  <i class="bi bi-exclamation-circle text-warning"></i>
                  <div>
                    <h4>Lorem Ipsum</h4>
                    <p>Quae dolorem earum veritatis oditseno</p>
                    <p>30 min. ago</p>
                  </div>
                </li>
    
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="notification-item">
                  <i class="bi bi-x-circle text-danger"></i>
                  <div>
                    <h4>Atque rerum nesciunt</h4>
                    <p>Quae dolorem earum veritatis oditseno</p>
                    <p>1 hr. ago</p>
                  </div>
                </li>
    
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="notification-item">
                  <i class="bi bi-check-circle text-success"></i>
                  <div>
                    <h4>Sit rerum fuga</h4>
                    <p>Quae dolorem earum veritatis oditseno</p>
                    <p>2 hrs. ago</p>
                  </div>
                </li>
    
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="notification-item">
                  <i class="bi bi-info-circle text-primary"></i>
                  <div>
                    <h4>Dicta reprehenderit</h4>
                    <p>Quae dolorem earum veritatis oditseno</p>
                    <p>4 hrs. ago</p>
                  </div>
                </li>
    
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li class="dropdown-footer">
                  <a href="#">Show all notifications</a>
                </li>
    
              </ul><!-- End Notification Dropdown Items -->
    
            </li><!-- End Notification Nav -->
    
            <li class="nav-item dropdown">
    
              <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                <i class="bi bi-chat-left-text"></i>
                <span class="badge bg-success badge-number">3</span>
              </a><!-- End Messages Icon -->
    
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow messages">
                <li class="dropdown-header">
                  You have 3 new messages
                  <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">View all</span></a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="message-item">
                  <a href="#">
                    <img src="assets/img/messages-1.jpg" alt="" class="rounded-circle">
                    <div>
                      <h4>Maria Hudson</h4>
                      <p>Velit asperiores et ducimus soluta repudiandae labore officia est ut...</p>
                      <p>4 hrs. ago</p>
                    </div>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="message-item">
                  <a href="#">
                    <img src="assets/img/messages-2.jpg" alt="" class="rounded-circle">
                    <div>
                      <h4>Anna Nelson</h4>
                      <p>Velit asperiores et ducimus soluta repudiandae labore officia est ut...</p>
                      <p>6 hrs. ago</p>
                    </div>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="message-item">
                  <a href="#">
                    <img src="assets/img/messages-3.jpg" alt="" class="rounded-circle">
                    <div>
                      <h4>David Muldon</h4>
                      <p>Velit asperiores et ducimus soluta repudiandae labore officia est ut...</p>
                      <p>8 hrs. ago</p>
                    </div>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li class="dropdown-footer">
                  <a href="#">Show all messages</a>
                </li>
    
              </ul><!-- End Messages Dropdown Items -->
    
            </li><!-- End Messages Nav -->
    
            <li class="nav-item dropdown pe-3">
    
              <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                <img src="assets/img/profile-img.jpg" alt="Profile" class="rounded-circle">
                <span class="d-none d-md-block dropdown-toggle ps-2">K. Anderson</span>
              </a><!-- End Profile Iamge Icon -->
    
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                <li class="dropdown-header">
                  <h6>전남대병원</h6>
                  <span>.</span>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                    <i class="bi bi-person"></i>
                    <span>My Profile</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                    <i class="bi bi-gear"></i>
                    <span>Account Settings</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                    <i class="bi bi-question-circle"></i>
                    <span>Need Help?</span>
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
    
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="#">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Sign Out</span>
                  </a>
                </li>
    
              </ul><!-- End Profile Dropdown Items -->
            </li><!-- End Profile Nav -->
    
          </ul>
        </nav><!-- End Icons Navigation -->
    
      </header>
    <!-- 테이블 생성 -->
    <div class="preview">
        <button id ="saveButton" type="button" class="btn btn-primary btn-sm">Save</button>
        <table id="grid" class="display" style="width:100%">
          
        </table>
    </div>


    <script>    
      $(document).ready(function() {
        var csrf_token = "{{ csrf_token }}";
        const createdGrid = initGrid();
        ajaxData(createdGrid);     
        console.log("sdfsdfsldkj")
        

        function initGrid() {
    // 그리드 객체
            const Grid = tui.Grid;         
            Grid.applyTheme('custom',  
            {
                    selection: {
                        background: '#4daaf9',
                        border: '#004082'
                    },
                    scrollbar: {
                        background: '#f5f5f5',
                        thumb: '#d9d9d9',
                        active: '#c1c1c1'
                    },
                    row: {
                        even: {
                        background: '#edeefc',
                        height: '32px'
                        },
                        odd:{
                            height: '32px'

                        },
                        hover: {
                        background: '#7982ec'
                        }
                    },
                    cell: {
                        normal: {
                        background: '#ffffff',
                        border: '#e0e0e0',
                        showVerticalBorder: true
                        },
                        header: {
                        background: '#515ce6',
                        border: '#ccc',
                        text:'#ffffff',
                        showVerticalBorder: true
                        },
                        rowHeader: {
                        border: '#ccc',
                        showVerticalBorder: true
                        },
                        editable: {
                        background: '#fbfbfb'
                        },
                        selectedHeader: {
                        background: '#224f96'
                        },
                        focused: {
                        border: '#418ed4'
                        },
                        disabled: {
                        text: '#b0b0b0'
                        }
                    }
                });        

            const sampleGrid = new Grid({
                language: {
                    localeCode: "ko",                           // localeCode : 언어 설정 (en, ko)
                    data: {
                        display: { 
                            noData: "검색 결과가 없습니다.",      // noData : 빈 값일 때 표시하는 형식
                        },
                    }
                },
                theme: {
                        selection: {
                        background: '#4daaf9',
                        border: '#004082'
                    },
                    scrollbar: {
                        background: '#f5f5f5',
                        thumb: '#d9d9d9',
                        active: '#c1c1c1'
                    },
                    row: {
                        even: {
                        background: '#edeefc'
                        },
                        hover: {
                        background: '#ccc'
                        }
                    },
                    cell: {
                        normal: {
                        background: '#ffffff',
                        border: '#e0e0e0',
                        showVerticalBorder: true
                        },
                        header: {
                        background: '#515ce6',
                        color:'#ffffff',
                        border: '#ccc',
                        showVerticalBorder: true
                        },
                        rowHeader: {
                        border: '#ccc',
                        showVerticalBorder: true
                        },
                        editable: {
                        background: '#fbfbfb'
                        },
                        selectedHeader: {
                        background: '#d8d8d8'
                        },
                        focused: {
                        border: '#418ed4'
                        },
                        disabled: {
                        text: '#b0b0b0'
                        }
                    }
                   /* presetName: "striped",                        // presetName : 기본 테마 설정 (default, striped, clean)
                    extOptions: {                               // <<커스텀 옵션설정>>
                        outline: {                              // [ outline ] : 그리드 바깥 선 설정
                            border: '#bbbbbb',                  //  border : 색깔
                            showVerticalBorder: true,           //  showVerticalBorder : 바깥 세로 선 여부(boolean)
                        },
                        selection: {                            // [ selection ] : 행, 열의 헤더를 선택하면 해당 부분이 선택되며 나오는 색상 설정
                        //   background: '#f5d1ba',              //  background : 바탕색
                        background : '#1eed11',
                            border: '#bbbbbb',                  //  border : 선 색
                        },
                            scrollbar: {                            // [ scrollbar ] : 스크롤바
                                border: 'rgb(205,205,205)',         //  border : 선 색
                                background: 'rgb(248,248,248)',     //  background : 바탕 색
                                emptySpace: 'rgb(240,240,240)',     //  emptySpace : 스크롤 빈 부분 색상
                                thumb: 'rgb(205,205,205)',          //  thumb : 스크롤 부분 색상
                                active: 'rgb(70,70,70)'             //  active : 마우스오버, 클릭할 때 색깔
                            },
                            frozenBorder: {                         // [ frozenBorder ] : 고정 컬럼 
                                border: '#ccc',         //  border : 선 색 
                            },
                            area: {                                 // [area] : 검색 후 표시된 열을 제외한 부분 ( 표의 높이 - 열의 높이 = area )
                                header: {                           
                                    background: '#ffffff', //  header : 컬럼이 없는 헤더의 색상을 나타낸다.
                                    border: '#ccc',                //  **border : [ cell ] - header 와 맞추는 것이 좋다. 현재는 오버되어 색상이 표기된다.
                                },
                                body: {                             //  body : 빈 열 값의 부분 색상
                                    background: '#ffffff',              
                                },
                            },
                        row: {                                  // [ row ] : 열
                            hover: {                            // hover : 마우스 오버시
                                background: '#ffffff',
                            },
                            dummy: {                            // dummy : 비활성 시
                                background: '#ffffff',
                            },
                        },
                        cell: {                             // [ cell ] : 각 셀의 색상 지정
                            normal: {
                                border: '#bbbbbb',
                                text: 'black',
                                showVerticalBorder: true,
                                showHorizontalBorder: true,
                            },
                            header: {                       //  header : 상단 제목 열
                                background: 'rgb(233, 233, 233)',
                                border: '#bbbbbb',
                                text: 'black',
                                showVerticalBorder: true,
                                showHorizontalBorder: true,
                            },
                            selectedHeader: {               //  selectedHeader : 선택한 제목 색상
                                background: 'rgb(233, 233, 233)',
                            },
                            rowHeader: {                    //  rowHeader : 좌측 제목 행
                                background: 'rgb(233, 233, 233)',
                                border: '#bbbbbb',
                                text: 'black',
                                showVerticalBorder: true,
                                showHorizontalBorder: true,
                            },
                            selectedRowHeader: {            //  selectedRowHeader : 선택한 열 색상
                                background: 'rgb(233, 233, 233)',
                            },
                            focused: {                      //  focused : 선택한 셀 색상 
                                background: "#f5d1ba",
                                border: "#bbbbbb",
                            },
                            focusedInactive: {              //  focusedInactive : 선택 후 표 바깥을 선택하면 나타나는 색상
                                border: "#bbbbbb"
                            },
                            summary: {                      //  summary : 요약 열에 사용할 색상
                                    background: '#f1f5ff',
                                    border: '#bbbbbb',
                                    text: 'black',
                                    showVerticalBorder: true,
                                    showHorizontalBorder: true,
                                },
                            },
                        },
                        */
                    },
                el: document.getElementById('grid'),
                scrollX: true,
                scrollY: true,
                editable: true, // 전체 그리드에 대한 편집 가능 설정
                draggable: false,
                header: { height: 30 },
                bodyHeight: 200,
                contextMenu: null,
                columnOptions: {                        // [ columnOptions ]
                        minWidth: 50,                       //  minWidth : 최소 너비 사이즈
                        resizable: true,                    //  resizable : 컬럼의 고정 폭을 조정 여부(boolean).
                        frozenCount: 0,                     //  frozenCount : 고정 컬럼의 개수
                        frozenBorderWidth: 1,               //  frozenBorderWidth : 고정 컬럼의 경계선 너비(px)
                    },
                columns: [
                        {
                            header: '테스트아이디',
                            name: 'test_id',
                            align: "center",
        
                            editor:'text',
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                        {
                            header: 'A항목',
                            name: 'test_a',
                            align: "left",
                         
                            editor:'text',
                            whiteSpace: 'normal',
                            formatter: function (e) { 
                                return e.value
                            },
                        },
                        {
                            header: 'B항목',
                            name: 'test_b',
                            align: "left",
                            editor:'text',
                        
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                        {
                            header: 'C항목',
                            name: 'test_c',
                            align: "left",
                           
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                    ],
               
                });

                return sampleGrid;
        }      
        
        function ajaxData(createdGrid) {
            fetch('./getData')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    createdGrid.resetData(data);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        $('#saveButton').on('click', function() {
                saveChanges();
        });


        function saveChanges() {
                const modifiedData = createdGrid.getModifiedRows();   
                updates=modifiedData.updatedRows
                $.ajax({
                    url: './updateData', // 서버의 데이터 저장 URL
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(updates),
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', csrf_token); // CSRF 토큰 설정
                    },
                    success: function(response) {
                        console.log('저장 성공:', response);
                    },
                    error: function(error) {
                        console.error('저장 실패:', error);
                    }
                });
            

              
                

            }

        function updateData(rows){

       
            /*$.ajax({
                    url: './updateData', // 서버의 데이터 저장 URL
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(rows),
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', csrf_token); // CSRF 토큰 설정
                    },
                    success: function(response) {
                        console.log('저장 성공:', response);
                    },
                    error: function(error) {
                        console.error('저장 실패:', error);
                    }
                });*/
        }

       

        
    });



        
    // 그리드 설정과 데이터 가져오기
        

</script>


</body>
</html>

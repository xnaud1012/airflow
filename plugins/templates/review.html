<!DOCTYPE html>
<html lang="en">
<head>
    <!--jquery-->
    <script src="{{ url_for('review_plugin.static', filename='./js/jquery-3.7.1.min.js') }}"></script>   


    <!--jq Grid-->


    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('review_plugin.static', filename='./jquery-ui-1.13.2/jquery-ui.css')}}">
    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('review_plugin.static', filename='./jquery.jqGrid-4.4.3/css/ui.jqgrid.css') }}">
    <script src="{{ url_for('review_plugin.static', filename='./jquery.jqGrid-4.4.3/js/jquery-1.7.2.min.js')}}"></script>   
    <script src="{{ url_for('review_plugin.static', filename='./jquery.jqGrid-4.4.3/js/i18n/grid.locale-kr.js')}}"></script>  
    <script src="{{ url_for('review_plugin.static', filename='./jquery.jqGrid-4.4.3/js/jquery.jqGrid.min.js')}}"></script>  
    <!-- DataTables CSS -->
   <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./toast_ui/tui-grid/dist/tui-grid.min.css') }}">-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/vendor/bootstrap-icons/bootstrap-icons.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/css/style.css') }}">
    <script src="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/vendor/tinymce/tinymce.min.js') }}"></script>   
    <script src="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/js/main.js') }}"></script>

</head>
<style>

#grid {
  width: 100%;
  min-width: 100px;
  /*min-width: 0; /* 또는 적절한 최소 너비 값 */
}


</style>
<body>
    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
          <a href="javascript:void(0);" class="logo d-flex align-items-center">
            <img src="{{ url_for('review_plugin.static', filename='./NiceAdmin/assets/img/logo.png') }}" alt="">
           
            <span class="d-none d-lg-block">전대병원TEST</span>
          </a>
       
        </div><!-- End Logo --> 

       
    
    </header>
    <main id="main">
     
        <section class="section dashboard">
            <div class="container"> 
                <div class="card" style="width:100%">
                    <div class="card-header"> 
                        <div style="display: grid;grid-template-columns: 1fr 1fr 1fr">
                            <div></div>
                            <div></div>
                            <div style="padding-right:10px;">  <button id ="saveButton" class="btn" style="float:right;" >
                                <i class="bi bi-check"></i>    
                                Save</button>
                            </div>                     
                        </div>
                     </div>

                    <div class="card-body">                
                 
                     

                        <table class="table" id="grid" style="margin-top:10px;width:100%" >
                        <div id="pager"></div>
                        </table>

                      
                    </div>
                    
                
            </div>
            </div>

        </section>

           
            <!-- 테이블 생성 -->
           
    </main>


    <script>   
     
    $(document).ready(function() {
    var csrf_token = "{{ csrf_token }}";   
    
    initGrid()

 
    });
       

    function initGrid() {


        $("#grid").jqGrid({       
            url:'./getData',
            loadtext:'loading...',
            colNames:['테스트 ID','테스트A항목','테스트B항목','테스트C항목'],
            colModel: [
                { name: 'test_id', width: 75 },
                { name: 'test_a', width: 150 },
                { name: 'test_b', width: 150 },
                { name: 'test_c', width: 150 }
            
            ],
            rowNum:10,
            autowidth:true,
            datatype:'json',
            rowList:[10,20,30],
            pager: '#pager',
            sortname: 'test_id',
            viewrecords: true,
            sortorder: "asc",
            jsonReader: {
                repeatitems : false,
                id: "0"
            },
            caption:"데이터검증 TEST",         
            height: '100'
        });
        
    
    
    }     
    
        
    function ajaxData() {
        var listData;
        fetch('./getData')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data)
                $('#grid').clearGridData();
                $('#grid').jqGrid('setGridParam',{data:data.listData});
                $('#grid').trigger('reloadGrid');

            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    }

    $('#saveButton').on('click', function() {
            saveChanges();
    });


    function saveChanges() {
            const modifiedData = createdGrid.getModifiedRows();   
            updates=modifiedData.updatedRows
            $.ajax({
                url: './updateData', // 서버의 데이터 저장 URL
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(updates),
                beforeSend: function(xhr) {
                    xhr.setRequestHeader('X-CSRFToken', csrf_token); // CSRF 토큰 설정
                },
                success: function(response) {
                    console.log('저장 성공:', response);
                },
                error: function(error) {
                    console.error('저장 실패:', error);
                }
            });
        }

        const createdGrid = initGrid();
 
           
        $(window).on('resize', function() {
          
    
        });
    
  

    </script>


</body>
</html>

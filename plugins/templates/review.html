<!DOCTYPE html>
<html lang="en">
<head>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('review_plugin.static', filename='./toast_ui/tui-grid/dist/tui-grid.min.css') }}">

    <script src="{{ url_for('review_plugin.static', filename='./js/jquery-3.7.1.min.js') }}"></script>
    
    <!-- DataTables JS -->
    <script src="{{ url_for('review_plugin.static', filename='./toast_ui/tui-grid/dist/tui-grid.min.js') }}"></script>

</head>
<style>


</style>
<body>

    <!-- 테이블 생성 -->
    <div class="container">
        <button id ="saveButton">Save</button>
        <table id="grid" class="display" style="width:100%">
          
        </table>
    </div>


    <script>    
      $(document).ready(function() {
        var csrf_token = "{{ csrf_token }}";
        const createdGrid = initGrid();
        ajaxData(createdGrid);     
        console.log("sdfsdfsldkj")
        

        function initGrid() {
    // 그리드 객체
            const Grid = tui.Grid;         
           /* Grid.applyTheme('striped',  {
                cell: {
                    normal: {
                        border: '#ccc'
                    },
                    header: {
                        background: 'gray',
                        text: 'white'
                    },
                    evenRow: {
                        background: '#fee'
                    }
                }
            });        */

            const sampleGrid = new Grid({
                language: {
                    localeCode: "ko",                           // localeCode : 언어 설정 (en, ko)
                    data: {
                        display: { 
                            noData: "검색 결과가 없습니다.",      // noData : 빈 값일 때 표시하는 형식
                        },
                    }
                },               
                el: document.getElementById('grid'),
                scrollX: true,
                scrollY: true,
                editable: true, // 전체 그리드에 대한 편집 가능 설정
                draggable: false,
                header: { height: 30 },
                bodyHeight: 200,
                contextMenu: null,
                columnOptions: {                        // [ columnOptions ]
                        minWidth: 50,                       //  minWidth : 최소 너비 사이즈
                        resizable: true,                    //  resizable : 컬럼의 고정 폭을 조정 여부(boolean).
                        frozenCount: 0,                     //  frozenCount : 고정 컬럼의 개수
                        frozenBorderWidth: 1,               //  frozenBorderWidth : 고정 컬럼의 경계선 너비(px)
                    },
                columns: [
                        {
                            header: '테스트아이디',
                            name: 'test_id',
                            align: "center",
                            width: 150,
                            editor:'text',
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                        {
                            header: 'A항목',
                            name: 'test_a',
                            align: "left",
                            width: 100,
                            editor:'text',
                            whiteSpace: 'normal',
                            formatter: function (e) { 
                                return e.value
                            },
                        },
                        {
                            header: 'B항목',
                            name: 'test_b',
                            align: "left",
                            editor:'text',
                            width: 150,
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                        {
                            header: 'C항목',
                            name: 'test_c',
                            align: "left",
                            width: 150,
                            whiteSpace: 'normal',
                            formatter: function (e) {
                                return e.value
                            },
                        },
                    ],
               
                });

                sampleGrid.applyTheme('striped', 
                            {
                                selection: {
                                    background: '#4daaf9',
                                    border: '#004082'
                                },
                                scrollbar: {
                                    background: '#f5f5f5',
                                    thumb: '#d9d9d9',
                                    active: '#c1c1c1'
                                },
                                row: {
                                    even: {
                                    background: '#f3ffe3'
                                    },
                                    hover: {
                                    background: '#ccc'
                                    }
                                },
                                cell: {
                                    normal: {
                                    background: '#fbfbfb',
                                    border: '#e0e0e0',
                                    showVerticalBorder: true
                                    },
                                    header: {
                                    background: '#eee',
                                    border: '#ccc',
                                    showVerticalBorder: true
                                    },
                                    rowHeader: {
                                    border: '#ccc',
                                    showVerticalBorder: true
                                    },
                                    editable: {
                                    background: '#fbfbfb'
                                    },
                                    selectedHeader: {
                                    background: '#d8d8d8'
                                    },
                                    focused: {
                                    border: '#418ed4'
                                    },
                                    disabled: {
                                    text: '#b0b0b0'
                                    }
                                }
                            }
                                                
                ); 

                return sampleGrid;
        }      
        
        function ajaxData(createdGrid) {
            fetch('./getData')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    createdGrid.resetData(data);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        $('#saveButton').on('click', function() {
                saveChanges();
        });


        function saveChanges() {
                const modifiedData = createdGrid.getModifiedRows();   
                updates=modifiedData.updatedRows
                $.ajax({
                    url: './updateData', // 서버의 데이터 저장 URL
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(updates),
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', csrf_token); // CSRF 토큰 설정
                    },
                    success: function(response) {
                        console.log('저장 성공:', response);
                    },
                    error: function(error) {
                        console.error('저장 실패:', error);
                    }
                });
            

              
                

            }

        function updateData(rows){

       
            /*$.ajax({
                    url: './updateData', // 서버의 데이터 저장 URL
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(rows),
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', csrf_token); // CSRF 토큰 설정
                    },
                    success: function(response) {
                        console.log('저장 성공:', response);
                    },
                    error: function(error) {
                        console.error('저장 실패:', error);
                    }
                });*/
        }

       

        
    });



        
    // 그리드 설정과 데이터 가져오기
        

</script>


</body>
</html>
